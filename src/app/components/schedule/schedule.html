<div class="bg-white dark:bg-stone-800 rounded-lg shadow-sm p-4">
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
    <h2 class="text-lg font-semibold text-stone-900 dark:text-stone-100">Weekly Schedule</h2>

    <div class="flex gap-2 w-full sm:w-auto">
      <button
        class="flex-1 sm:flex-none px-4 py-2 bg-gradient-to-r from-emerald-600 to-emerald-700 text-white font-medium rounded-lg hover:from-emerald-700 hover:to-emerald-800 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 dark:focus:ring-offset-stone-800 transition transform hover:scale-105 active:scale-95 shadow-md"
        (click)="createSchedule()">
        <div class= "flex justify-center items-center gap-1">
            <lucide-icon [img]="CalendarPlus" class="my-icon h-4 w-4"></lucide-icon>
            <span>Generate</span>
        </div>
      </button>
      <button
        class="flex-1 sm:flex-none px-4 py-2 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 dark:focus:ring-offset-stone-800 transition disabled:opacity-40 disabled:cursor-not-allowed"
        (click)="clearSchedule()"
        [disabled]="slots().length === 0">
        <div class= "flex justify-center items-center gap-1">
            <lucide-icon [img]="Trash" class="my-icon h-4 w-4"></lucide-icon>
            <span>Clear</span>
        </div>
      </button>
    </div>
  </div>

  @if (loading()) {
    <div class="grid grid-cols-7 gap-3 animate-pulse">
      @for (i of [1,2,3,4,5,6,7]; track i) {
        <div class="min-h-64 bg-stone-200 dark:bg-stone-700 rounded-lg"></div>
      }
    </div>
  } @else {
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-7 gap-3">
      @for (day of days; track day) {
        <div
          cdkDropList
          [cdkDropListData]="grouped()[day]"
          (cdkDropListDropped)="onDrop($event, day)"
          class="p-4 bg-gradient-to-br from-stone-50 to-stone-100 dark:from-stone-700 dark:to-stone-600 rounded-lg border-2 border-dashed border-stone-300 dark:border-stone-600 hover:border-emerald-400 dark:hover:border-emerald-500 transition-colors min-h-72">
          
          <h3 class="text-sm font-bold text-stone-900 dark:text-stone-100 text-center mb-3 pb-2 border-b-2 border-stone-200 dark:border-stone-500 uppercase tracking-wider">{{ day }}</h3>
          
          @if (grouped()[day].length === 0) {
            <div class="text-center text-stone-400 dark:text-stone-500 text-xs py-6">
              <p>Drop habits here</p>
            </div>
          } @else {
            <div class="space-y-2">
              @for (slot of grouped()[day]; track slot.id) {
                <div
                  cdkDrag
                  [cdkDragData]="slot"
                  
                  class="group p-3 bg-white dark:bg-stone-800 rounded-lg border-l-4 shadow-sm hover:shadow-md cursor-move"
                  [style.borderColor]="getStatusColor(slot.status)"
                  [class.opacity-50]="slot.status === 2"
                  [class.ring-2]="slot.status === 1"
                  [class.ring-green-500]="slot.status === 1">
                  
                  <div class="flex items-start justify-between gap-2">
                    <div class="flex-1 min-w-0">
                      <p class="font-semibold text-sm text-stone-900 dark:text-stone-100 truncate" [class.line-through]="slot.status === 1">{{ slot.habitName }}</p>
                      <p class="text-xs text-stone-500 dark:text-stone-400 mt-1">{{ formatTime(slot.startTime) }}</p>
                      
                      @if (slot.status === 0) {
                        <div class="flex gap-1 mt-2">
                          <button
                            class="flex-1 text-xs px-2 py-1 bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 hover:bg-green-200 dark:hover:bg-green-800 rounded transition-colors font-medium"
                            (click)="complete(slot.id)">
                            ✓ Done
                          </button>
                          <button
                            class="flex-1 text-xs px-2 py-1 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 hover:bg-red-200 dark:hover:bg-red-800 rounded transition-colors font-medium"
                            (click)="miss(slot.id)">
                            ✕ Miss
                          </button>
                        </div>
                      }
                      
                      @if (slot.status === 2) {
                        <button
                            class="w-full text-xs px-2 py-1 mt-2 bg-amber-100 dark:bg-amber-900 text-amber-700 dark:text-amber-300 hover:bg-amber-200 dark:hover:bg-amber-800 rounded transition-colors font-medium"
                            (click)="reschedule(slot.id)">
                            <div class= "flex justify-center items-center gap-1">
                                <lucide-icon [img]="CalendarSync" class="my-icon h-4 w-4"></lucide-icon>
                                <span>Reschedule</span>
                            </div>
                        </button>
                      }
                    </div>
                    
                    <button
                      class="p-1 text-stone-400 hover:text-red-500 hover:bg-red-100 dark:hover:bg-red-900 rounded transition-all flex-shrink-0"
                      (click)="delete(slot.id)">
                      ✕
                    </button>
                  </div>
                </div>
              }
            </div>
          }
        </div>
      }
    </div>
  }
</div>