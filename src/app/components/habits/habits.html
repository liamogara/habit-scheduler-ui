<div class="bg-white dark:bg-stone-800 rounded-lg shadow-sm p-4">
    <h2 class="text-lg font-medium mb-6">Habits</h2>
    <div class="mb-6 p-6 bg-gradient-to-br from-emerald-50 to-stone-50 dark:from-stone-700 dark:to-stone-800 rounded-lg border border-emerald-200 dark:border-emerald-900">
        <h3 class="text-sm font-semibold text-stone-700 dark:text-stone-200 mb-4 uppercase tracking-wider">Add New Habit</h3>
        
        <form class="space-y-4" (ngSubmit)="createHabit()">
            <div>
                <label for="name" class="block text-sm font-medium text-stone-700 dark:text-stone-300 mb-1">Habit Name *</label>
                <input
                    id="name"
                    type="text"
                    class="w-full px-4 py-2 rounded-lg border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-900 text-stone-900 dark:text-stone-100 placeholder-stone-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition"
                    placeholder="Enter habit name"
                    [(ngModel)]="newHabit.name"
                    name="name"
                    required />
            </div>

            <div class="flex flex-col gap-4 ">
                <div>
                    <label for="freq" class="block text-sm font-medium text-stone-700 dark:text-stone-300 mb-1">Frequency *</label>
                    <input
                        id="freq"
                        type="number"
                        min="1"
                        max="7"
                        class="w-full px-4 py-2 rounded-lg border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-900 text-stone-900 dark:text-stone-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition"
                        placeholder="1-7"
                        [(ngModel)]="newHabit.frequencyPerWeek"
                        name="freq" />
                </div>

                <div>
                    <label for="duration" class="block text-sm font-medium text-stone-700 dark:text-stone-300 mb-1">Duration(min)</label>
                    <input
                        id="duration"
                        type="number"
                        min="0"
                        max="120"
                        class="w-full px-4 py-2 rounded-lg border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-900 text-stone-900 dark:text-stone-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition"
                        placeholder="30"
                        [(ngModel)]="newHabit.minDurationMinutes"
                        name="duration" />
                </div>

                <div>
                    <label class="block text-sm font-medium text-stone-700 dark:text-stone-300 mb-2">Preferred Time Window</label>
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <label for="start-hour" class="text-xs text-stone-600 dark:text-stone-400 mb-1 block">Start(hr)</label>
                            <input
                                id="start-hour"
                                type="number"
                                min="0"
                                max="23"
                                class="w-full px-3 py-2 rounded-lg border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-900 text-stone-900 dark:text-stone-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition text-center"
                                placeholder="8"
                                [(ngModel)]="newHabit.startHour"
                                name="start" />
                        </div>
                        <div>
                            <label for="end-hour" class="text-xs text-stone-600 dark:text-stone-400 mb-1 block">End(hr)</label>
                            <input
                                id="end-hour"
                                type="number"
                                min="1"
                                max="24"
                                class="w-full px-3 py-2 rounded-lg border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-900 text-stone-900 dark:text-stone-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition text-center"
                                placeholder="18"
                                [(ngModel)]="newHabit.endHour"
                                name="end" />
                        </div>
                    </div>
                </div>
            </div>

            <button
                type="submit"
                class="w-full px-6 py-3 mt-2 bg-gradient-to-r from-emerald-600 to-emerald-700 text-white font-semibold rounded-lg hover:from-emerald-700 hover:to-emerald-800 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 dark:focus:ring-offset-stone-800 transition transform hover:scale-105 active:scale-95 shadow-md">
                <div class= "flex justify-center items-center gap-1">
                    <lucide-icon [img]="AlarmClockPlus" class="my-icon h-4 w-4"></lucide-icon>
                    <span>Add Habit</span>
                </div>
            </button>
        </form>
    </div>


    @if (loading()) {
        <div class="space-y-3 animate-pulse">
            <div class="h-20 bg-stone-200 dark:bg-stone-700 rounded-lg"></div>
            <div class="h-20 bg-stone-200 dark:bg-stone-700 rounded-lg"></div>
            <div class="h-20 bg-stone-200 dark:bg-stone-700 rounded-lg"></div>
        </div>
    } @else {
        <div 
        cdkDropList
        class="space-y-3">
            @if (habits().length === 0) {
                <div class="text-center py-8 text-stone-500 dark:text-stone-400">
                    <p class="text-sm">You haven't added any habits yet!</p>
                </div>
            } @else {
                @for (habit of habits(); track habit.id) {
                    <div
                        cdkDrag
                        [cdkDragData]="habit"
                        class="p-4 bg-gradient-to-r from-stone-50 to-stone-100 dark:from-stone-700 dark:to-stone-600 rounded-lg border border-emerald-200 dark:border-emerald-800 hover:shadow-md hover:border-emerald-400 dark:hover:border-emerald-600 cursor-move group">
                        <div class="flex items-start justify-between gap-3">
                            <div class="flex-1 min-w-0">
                                <h3 class="font-semibold text-stone-900 dark:text-stone-100 truncate group-hover:text-emerald-600 dark:group-hover:text-emerald-400 transition">{{ habit.name }}</h3>
                                <div class="flex flex-wrap gap-2 mt-2">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-emerald-100 dark:bg-emerald-900 text-emerald-800 dark:text-emerald-200">
                                        ğŸ“… {{ habit.frequencyPerWeek }}/week
                                    </span>
                                    @if (habit.minDurationMinutes) {
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200">
                                            â±ï¸ {{ habit.minDurationMinutes }}min
                                        </span>
                                    }
                                    @if (habit.startHour && habit.endHour) {
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200">
                                            ğŸ• {{ habit.startHour }}:00-{{ habit.endHour }}:00
                                        </span>
                                    }
                                </div>
                            </div>
                            
                            <button
                                (click)="delete(habit.id)"
                                class="p-2 text-stone-400 hover:text-red-500 hover:bg-red-100 dark:hover:bg-red-900 rounded-lg transition-all flex-shrink-0">
                                <span class="text-lg">âœ•</span>
                            </button>
                        </div>
                        
                        <div class="text-xs text-stone-500 dark:text-stone-400 mt-2 flex items-center gap-1">
                            <lucide-icon [img]="Target" class="my-icon h-4 w-4 text-red-500"></lucide-icon>
                            <span>Drag to schedule</span>
                        </div>
                    </div>
                }
            }
        </div>
    }

    <div class="flex gap-2 mt-6 pt-4 border-t border-stone-200 dark:border-stone-700">
        <button
            class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 dark:focus:ring-offset-stone-800 transition disabled:opacity-40 disabled:cursor-not-allowed font-medium"
            (click)="clearHabits()"
            [disabled]="habits().length === 0">
            <div class= "flex justify-center items-center gap-1">
                <lucide-icon [img]="Trash" class="my-icon h-4 w-4"></lucide-icon>
                <span>Clear Habits</span>
            </div>
        </button>
    </div>

</div>

